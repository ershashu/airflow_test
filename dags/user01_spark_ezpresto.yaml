apiVersion: sparkoperator.hpe.com/v1beta2
kind: SparkApplication
metadata:
  name: spark-ezpresto
spec:
  type: Python
  sparkVersion: 3.5.0
  mode: cluster
  image: '{{dag_run.conf.get("airgap_registry_url", "")}}gcr.io/mapr-252711/spark-py-3.5.0:v3.5.0'
  imagePullPolicy: Always
  mainApplicationFile: local:///mounts/{{dag_run.conf.get("username", "")}}-volume/spark_test_data/ezpresto_query.py
  restartPolicy:
    type: Never
  imagePullSecrets:
    - imagepull
  driver:
    cores: 1
    coreLimit: 1000m
    memory: 1024m
    labels:
      version: 3.5.0
    volumeMounts:
      - name: '{{dag_run.conf.get("username", "")}}-volume'
        mountPath: /mounts/{{dag_run.conf.get("username", "")}}-volume
      - name: shared-volume
        mountPath: /mounts/shared-volume
  executor:
    cores: 1
    coreLimit: 1000m
    instances: 1
    memory: 2G
    labels:
      version: 3.5.0
    volumeMounts:
      - name: '{{dag_run.conf.get("username", "")}}-volume'
        mountPath: /mounts/{{dag_run.conf.get("username", "")}}-volume
      - name: shared-volume
        mountPath: /mounts/shared-volume
  volumes:
    - name: '{{dag_run.conf.get("username", "")}}-volume'
      persistentVolumeClaim:
        claimName: user-pvc
    - name: shared-volume
      persistentVolumeClaim:
        claimName: kubeflow-shared-pvc